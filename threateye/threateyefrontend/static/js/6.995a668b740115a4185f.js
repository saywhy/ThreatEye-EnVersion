webpackJsonp([6],{"5eDA":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("mvHQ"),i=s.n(a),l=s("PJh5"),o=s.n(l),n={name:"user_management",data:function(){return{loading:!1,user_list:{},user_data:{page:1,rows:10,placeholder:"",password:{}},user_state:{add:!1,edit:!1},user_add:{username:"",password:"",Re_password:"",department:"",mobile:"",email_addr:"",role:"",allow_ip:"",role_list:[]},user_edit:{password:"",Re_password:"",department:"",mobile:"",email_addr:"",role:"",id:"",allow_ip:"",role_list:[]},token_data:"",select_list:[]}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data(),this.role_list(),this.get_menu(),this.getPwdLength()},methods:{edit_pswd:function(){var t=this;this.$axios.get("/yiiapi/site/get-self-password-reset-token").then(function(e){var s=e.data,a=s.status,i=s.data;console.log(a),console.log(i.data.token);var l=i.data.token;t.$axios.post("/yiiapi/site/reset-self-password?token="+l,{ResetPasswordForm:{password:"Hoohoolab*1234",mobile:"151111211111",mail_addr:"12312312@qq.com",department:"123"},old_password:"Hoohoolab*123"}).then(function(t){var e=t.data,s=e.status,a=e.data;console.log(s),console.log(a)}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},get_menu:function(){this.$axios.get("/yiiapi/site/menu").then(function(t){console.log(t)}).catch(function(t){console.log(t)})},get_data:function(){var t=this;this.loading=!0,this.$axios.get("/yiiapi/user/page",{params:{page:this.user_data.page,rows:this.user_data.rows}}).then(function(e){t.loading=!1,console.log(e),t.user_list=e.data.data,t.user_list.data.forEach(function(t,e){t.index_cn=e+1})}).catch(function(t){console.log(t)})},role_list:function(){var t=this;this.$axios.get("/yiiapi/user/role-list",{params:{page:1,rows:999}}).then(function(e){console.log(e),t.user_add.role_list=e.data.data.data,t.user_edit.role_list=e.data.data.data}).catch(function(t){console.log(t)})},getPwdLength:function(){var t=this;this.$axios.get("/yiiapi/site/get-passwd-length").then(function(e){console.log(e),t.user_data.password=e.data.data,t.user_data.placeholder="请输入包含大写、小写、数字和特殊字符其中三项,"+e.data.data.min_passwd_len+"-"+e.data.data.max_passwd_len+"位密码"}).catch(function(t){console.log(t)})},regex:function(t){return new RegExp("(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9])").test(t)},add_user:function(){var t=this;return""==this.user_add.username?(this.$message({message:"请输入用户名",type:"warning"}),!1):""==this.user_add.password?(this.$message({message:"请输入密码",type:"warning"}),!1):this.user_add.password!=this.user_add.Re_password?(this.$message({message:"两次输入密码不一致",type:"warning"}),!1):this.regex(this.user_add.password)?void this.$axios.post("/yiiapi/user/user-add",{username:this.user_add.username,password:this.user_add.password,role:this.user_add.role,department:this.user_add.department,allow_ip:this.user_add.allow_ip,mobile:this.user_add.mobile,email_addr:this.user_add.email_addr}).then(function(e){console.log(e),1==e.data.status?t.$message({message:e.data.msg,type:"error"}):0==e.data.status&&(t.get_data(),t.user_state.add=!1,t.$message({message:"添加用户成功",type:"success"}))}).catch(function(t){console.log(t)}):(this.$message({message:"密码必须同时包含大写、小写、数字和特殊字符其中三项",type:"warning"}),!1)},add_box:function(){this.user_state.add=!0,this.user_add.username="",this.user_add.password="",this.user_add.Re_password="",this.user_add.department="",this.user_add.mobile="",this.user_add.email_addr="",this.user_add.role="",this.user_add.allow_ip="",this.getPwdLength(),this.role_list()},edit_box:function(t){this.getPwdLength(),this.role_list(),this.user_state.edit=!0,console.log(t);var e=i()(t);this.user_edit.department=JSON.parse(e).department,this.user_edit.mobile=JSON.parse(e).mobile,this.user_edit.email_addr=JSON.parse(e).email_addr,this.user_edit.role=JSON.parse(e).role,this.user_edit.allow_ip=JSON.parse(e).allow_ip,this.user_edit.id=JSON.parse(e).id},edit_user:function(){var t=this;return console.log(this.user_edit),this.user_edit.password!=this.user_edit.Re_password?(this.$message({message:"两次输入密码不一致",type:"warning"}),!1):this.regex(this.user_edit.password)||""==this.user_edit.password?void this.$axios.get("/yiiapi/user/get-password-reset-token",{params:{id:this.user_edit.id}}).then(function(e){console.log(e.data),t.token_data=e.data.data,localStorage.setItem("token",e.data.data.token),t.$axios.put("/yiiapi/user/reset-password?token="+localStorage.getItem("token"),{ResetPasswordForm:{password:t.user_edit.password,allow_ip:t.user_edit.allow_ip,role:t.user_edit.role,email_addr:t.user_edit.email_addr,mobile:t.user_edit.mobile,department:t.user_edit.department}}).then(function(e){t.user_state.edit=!1,0==e.data.status?(t.get_data(),t.$message({message:"修改用户成功",type:"success"})):t.$message({message:e.data.msg,type:"error"})}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)}):(this.$message({message:"密码必须同时包含大写、小写、数字和特殊字符其中三项",type:"warning"}),!1)},del_user:function(){var t=this;if(console.log(this.select_list),0==this.select_list.length)return this.$message({message:"请选择需要删除的用户！",type:"warning"}),!1;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.select_list.forEach(function(t){e.push(t.id)}),t.$axios.delete("/yiiapi/user/user-del",{data:{id:e}}).then(function(e){console.log(e),0==e.data.status?(t.get_data(),t.$message({message:"删除成功！",type:"success"})):t.$message({message:"删除失败！",type:"error"})}).catch(function(t){console.log(t)})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleSizeChange:function(t){this.user_data.rows=t,this.user_data.page=1,this.get_data()},handleCurrentChange:function(t){this.user_data.page=t,this.get_data()},handleSelectionChange:function(t){this.select_list=t},alert_detail:function(){},closed_add_box:function(){this.user_state.add=!1},closed_edit_box:function(){this.user_state.edit=!1}},filters:{formatDate:function(t){return o()(t).format("YYYY-MM-DD HH:mm:ss")}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"user_management"}},[a("div",{staticClass:"user_title"},[a("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:t.add_box}},[t._v("新增")]),t._v(" "),a("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:t.del_user}},[t._v("删除")])],1),t._v(" "),a("div",{staticClass:"user_table"},[a("el-table",{ref:"multipleTable",staticClass:"reset_table",staticStyle:{width:"100%"},attrs:{align:"center",data:t.user_list.data,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange,"row-click":t.alert_detail}},[a("el-table-column",{attrs:{label:"全选",prop:"type",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{label:"序号",width:"50","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s((t.user_data.page-1)*t.user_data.rows+e.row.index_cn)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"department",label:"部门",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"email_addr",label:"邮箱","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"role",label:"角色",width:"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"creatorname",width:"120",label:"创建人","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("formatDate")(1e3*e.row.updated_at)))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"btn_edit",attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),t.edit_box(e.row)}}},[t._v("编辑")])]}}])})],1),t._v(" "),a("el-pagination",{staticClass:"pagination_box",attrs:{"current-page":t.user_list.pageNow,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next",total:t.user_list.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:t.user_state.add},on:{"update:visible":function(e){return t.$set(t.user_state,"add",e)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:t.closed_add_box}}),t._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),t._v(" "),a("span",{staticClass:"title_name"},[t._v("添加用户")])]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("用户名")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入用户名",clearable:""},model:{value:t.user_add.username,callback:function(e){t.$set(t.user_add,"username",e)},expression:"user_add.username"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("密码")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:t.user_data.placeholder,"show-password":""},model:{value:t.user_add.password,callback:function(e){t.$set(t.user_add,"password",e)},expression:"user_add.password"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("确认密码")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请确认密码","show-password":""},model:{value:t.user_add.Re_password,callback:function(e){t.$set(t.user_add,"Re_password",e)},expression:"user_add.Re_password"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("邮箱")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:t.user_add.email_addr,callback:function(e){t.$set(t.user_add,"email_addr",e)},expression:"user_add.email_addr"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("手机号")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入手机号",clearable:""},model:{value:t.user_add.mobile,callback:function(e){t.$set(t.user_add,"mobile",e)},expression:"user_add.mobile"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("部门")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入部门",clearable:""},model:{value:t.user_add.department,callback:function(e){t.$set(t.user_add,"department",e)},expression:"user_add.department"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色")])]),t._v(" "),a("el-select",{staticClass:"select_box",attrs:{placeholder:"请选择角色"},model:{value:t.user_add.role,callback:function(e){t.$set(t.user_add,"role",e)},expression:"user_add.role"}},t._l(t.user_add.role_list,function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1)]),t._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:t.closed_add_box}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:t.add_user}},[t._v("确定")])],1)]),t._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:t.user_state.edit},on:{"update:visible":function(e){return t.$set(t.user_state,"edit",e)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:t.closed_edit_box}}),t._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),t._v(" "),a("span",{staticClass:"title_name"},[t._v("编辑用户")])]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("密码")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:t.user_data.placeholder,"show-password":""},model:{value:t.user_edit.password,callback:function(e){t.$set(t.user_edit,"password",e)},expression:"user_edit.password"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("确认密码")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请再次输入密码","show-password":""},model:{value:t.user_edit.Re_password,callback:function(e){t.$set(t.user_edit,"Re_password",e)},expression:"user_edit.Re_password"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("邮箱")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:t.user_edit.email_addr,callback:function(e){t.$set(t.user_edit,"email_addr",e)},expression:"user_edit.email_addr"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("手机号")]),t._v(" "),a("span",{staticClass:"red"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入手机号",clearable:""},model:{value:t.user_edit.mobile,callback:function(e){t.$set(t.user_edit,"mobile",e)},expression:"user_edit.mobile"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("部门")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入部门",clearable:""},model:{value:t.user_edit.department,callback:function(e){t.$set(t.user_edit,"department",e)},expression:"user_edit.department"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色")])]),t._v(" "),a("el-select",{staticClass:"select_box",attrs:{placeholder:"请选择角色"},model:{value:t.user_edit.role,callback:function(e){t.$set(t.user_edit,"role",e)},expression:"user_edit.role"}},t._l(t.user_edit.role_list,function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1)]),t._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:t.closed_edit_box}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:t.edit_user}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var d=s("VU/8")(n,r,!1,function(t){s("J8Ht"),s("Ct0g")},"data-v-abd1fa04",null).exports,c={name:"role_management",data:function(){return{data:[{id:1,label:"首页",children:[{id:2,label:"总览"}]},{id:13,label:"处置",children:[{id:14,label:"资产维度"},{id:23,label:"风险维度",children:[{id:24,label:"外部威胁"},{id:32,label:"横向威胁"},{id:40,label:"外联威胁"}]},{id:48,label:"工单中心"}]},{id:58,label:"告警",children:[{id:59,label:"网络告警"}]},{id:76,label:"追查",children:[{id:77,label:"DNS追查"},{id:81,label:"IP/URL追查"},{id:85,label:"主机追查"},{id:93,label:"用户追查"},{id:97,label:"文件追查"},{id:101,label:"数据传输追查"},{id:105,label:"流量方向追查"},{id:109,label:"IOC扫描器"}]},{id:123,label:"报表",children:[{id:124,label:"报表生成"},{id:130,label:"报表发送"}]},{id:132,label:"系统",children:[{id:133,label:"设备管理"},{id:139,label:"受监控IP"},{id:144,label:"账号管理"},{id:157,label:"网络配置"},{id:162,label:"系统选项"},{id:169,label:"规则库及白名单"},{id:183,label:"联动"},{id:187,label:"威胁通知"},{id:191,label:"日志"},{id:204,label:"恢复/重启"},{id:207,label:"许可证"}]}],defaultProps:{children:"children",label:"label"},role_list:{},role_data:{page:1,rows:10},role_state:{add:!1,edit:!1},role_add:{name:"",describe:"",permissions_id:[]},role_edit:{},old_role_edit:"",select_list:[],loading:!1}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data(),this.get_version()},methods:{get_version:function(){var t=this;this.$axios.get("/yiiapi/site/license-version").then(function(e){var s=e.data,a=(s.status,s.data);console.log(a.edition),2==a.edition&&t.data.forEach(function(t){"追查"==t.label&&t.children.push({id:117,label:"沙箱"})})}).catch(function(t){console.log(t)})},get_data:function(){var t=this;this.loading=!0,this.$axios.get("/yiiapi/user/role-list",{params:{page:this.role_data.page,rows:this.role_data.rows}}).then(function(e){t.loading=!1,console.log(e.data),t.role_list=e.data.data,t.role_list.data.forEach(function(t,e){t.index_cn=e+1})}).catch(function(t){console.log(t)})},add_box:function(){this.role_state.add=!0,this.role_add.name="",this.role_add.describe="",this.role_add.permissions_id=[],this.resetChecked()},edit_box:function(t){var e=this;this.role_edit={},this.old_role_edit="",this.role_state.edit=!0,this.old_role_edit=i()(t),this.role_edit_cn=i()(t),this.role_edit=JSON.parse(this.role_edit_cn),console.log(this.role_edit),this.role_edit.permissions_id_cn=JSON.parse(this.role_edit.permissions_id),console.log(this.role_edit.permissions_id_cn);var s=[];this.role_edit.permissions_id_cn.forEach(function(t){1!=t&&13!=t&&23!=t&&123!=t&&76!=t&&132!=t&&58!=t&&s.push(t)}),this.$nextTick(function(){e.$refs.tree_edit.setCheckedKeys(s)})},handleSizeChange:function(t){this.role_data.rows=t,this.role_data.page=1,this.get_data()},handleCurrentChange:function(t){this.role_data.page=t,this.get_data()},closed_add_box:function(){this.role_state.add=!1},closed_edit_box:function(){this.role_state.edit=!1},add_role:function(){var t=this;return""==this.role_add.name?(this.$message({message:"请输入角色名称",type:"warning"}),!1):0==this.$refs.tree.getCheckedNodes().length?(this.$message({message:"请至少选择一项角色权限",type:"warning"}),!1):(this.$refs.tree.getCheckedNodes().forEach(function(e){t.role_add.permissions_id.push(e.id)}),this.$refs.tree.getHalfCheckedNodes().forEach(function(e){t.role_add.permissions_id.push(e.id)}),this.loading=!0,void this.$axios.post("/yiiapi/user/add-role",{name:this.role_add.name,description:this.role_add.describe,permissions_id:this.role_add.permissions_id}).then(function(e){t.loading=!1,console.log(e),0==e.data.status&&(t.role_state.add=!1,t.get_data(),t.$message({message:"添加角色成功",type:"success"}))}).catch(function(t){console.log(t)}))},edit_role:function(){var t=this;return console.log(this.role_edit),this.role_edit.permissions_id_edit=[],""==this.role_edit.name?(this.$message({message:"请输入角色名称",type:"warning"}),!1):0==this.$refs.tree_edit.getCheckedNodes().length?(this.$message({message:"请至少选择一项角色权限",type:"warning"}),!1):(this.$refs.tree_edit.getCheckedNodes().forEach(function(e){t.role_edit.permissions_id_edit.push(e.id)}),this.$refs.tree_edit.getHalfCheckedNodes().forEach(function(e){t.role_edit.permissions_id_edit.push(e.id)}),void this.$axios.post("/yiiapi/user/edit-role",{id:this.role_edit.id,old_name:JSON.parse(this.old_role_edit).name,name:this.role_edit.name,description:this.role_edit.description,permissions_id:this.role_edit.permissions_id_edit}).then(function(e){console.log(e),0==e.data.status?(t.role_state.edit=!1,t.get_data(),t.$message({message:"修改角色成功！",type:"success"})):1==e.data.status&&t.$message({message:e.data.msg,type:"error"})}).catch(function(t){console.log(t)}))},del_role:function(){var t=this;if(console.log(this.select_list),0==this.select_list.length)return this.$message({message:"请选择需要删除的角色！",type:"warning"}),!1;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.select_list.forEach(function(t){e.push(t.name)}),t.$axios.delete("/yiiapi/user/del-role",{data:{role_name:e}}).then(function(e){console.log(e.data),0==e.data.status?(t.get_data(),t.$message({message:"删除成功！",type:"success"})):t.$message({message:e.data.msg,type:"error"})}).catch(function(t){console.log(t)})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleSelectionChange:function(t){this.select_list=t},checkSelectable:function(t){return"SYSTEM"!=t.creatorname},getCheckedKeys:function(){console.log(this.$refs.tree.getCheckedKeys())},setCheckedNodes:function(){},setCheckedKeys:function(){},resetChecked:function(){this.$refs.tree.setCheckedKeys([])}},filters:{formatDate:function(t){return o()(t).format("YYYY-MM-DD HH:mm:ss")}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"role_management"}},[a("div",{staticClass:"role_title"},[a("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:t.add_box}},[t._v("新增")]),t._v(" "),a("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:t.del_role}},[t._v("删除")])],1),t._v(" "),a("div",{staticClass:"role_table"},[a("el-table",{ref:"multipleTable",staticClass:"reset_table",staticStyle:{width:"100%"},attrs:{align:"center",data:t.role_list.data,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{label:"全选",prop:"type",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{type:"selection",selectable:t.checkSelectable,width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"index",label:"序号",width:"50","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s((t.role_data.page-1)*t.role_data.rows+e.row.index_cn)+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"角色名称",width:"180","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"角色描述","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"220","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("formatDate")(1e3*e.row.created_at)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"creatorname",label:"创建人",width:"180","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["SYSTEM"!=e.row.creatorname?a("el-button",{staticClass:"btn_edit",attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),t.edit_box(e.row)}}},[t._v("编辑")]):t._e()]}}])})],1),t._v(" "),a("el-pagination",{staticClass:"pagination_box",attrs:{"current-page":t.role_list.pageNow,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next",total:t.role_list.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:t.role_state.add},on:{"update:visible":function(e){return t.$set(t.role_state,"add",e)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:t.closed_add_box}}),t._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),t._v(" "),a("span",{staticClass:"title_name"},[t._v("添加角色")])]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色名称")]),t._v(" "),a("span",{staticClass:"red_necessary"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入角色名称",clearable:""},model:{value:t.role_add.name,callback:function(e){t.$set(t.role_add,"name",e)},expression:"role_add.name"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色权限")]),t._v(" "),a("span",{staticClass:"red_necessary"},[t._v("*")])]),t._v(" "),a("el-tree",{ref:"tree",attrs:{data:t.data,"show-checkbox":"","highlight-current":"","node-key":"id",props:t.defaultProps,"default-expand-all":!1}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色描述")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{type:"textarea",rows:2,autosize:"",resize:"none",placeholder:"请输入角色描述"},model:{value:t.role_add.describe,callback:function(e){t.$set(t.role_add,"describe",e)},expression:"role_add.describe"}})],1)]),t._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:t.closed_add_box}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:t.add_role}},[t._v("确定")])],1)]),t._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:t.role_state.edit},on:{"update:visible":function(e){return t.$set(t.role_state,"edit",e)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:t.closed_edit_box}}),t._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),t._v(" "),a("span",{staticClass:"title_name"},[t._v("编辑角色")])]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色名称")]),t._v(" "),a("span",{staticClass:"red_necessary"},[t._v("*")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入角色名称",clearable:""},model:{value:t.role_edit.name,callback:function(e){t.$set(t.role_edit,"name",e)},expression:"role_edit.name"}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色权限")]),t._v(" "),a("span",{staticClass:"red_necessary"},[t._v("*")])]),t._v(" "),a("el-tree",{ref:"tree_edit",attrs:{data:t.data,"show-checkbox":"","highlight-current":"","node-key":"id",props:t.defaultProps,"default-expand-all":!1}})],1),t._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[t._v("角色描述")])]),t._v(" "),a("el-input",{staticClass:"select_box",attrs:{type:"textarea",rows:4,autosize:"",resize:"none",placeholder:"请输入角色描述"},model:{value:t.role_edit.description,callback:function(e){t.$set(t.role_edit,"description",e)},expression:"role_edit.description"}})],1)]),t._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:t.closed_edit_box}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:t.edit_role}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var u=s("VU/8")(c,_,!1,function(t){s("MI9h"),s("JKxE")},"data-v-502b4378",null).exports,p={name:"security_policy",data:function(){return{security_policy:{},security_policy_status:{loading:!1,switch:!0}}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data()},methods:{get_data:function(){var t=this;this.security_policy_status.loading=!0,this.$axios.get("/yiiapi/securitypolicy/get-security-policy").then(function(e){console.log(e),t.security_policy=e.data.data,"1"==t.security_policy.status?t.security_policy_status.switch=!0:t.security_policy_status.switch=!1,t.security_policy_status.loading=!1}).catch(function(t){console.log(t)})},set_data:function(){var t=this;this.security_policy_status.switch?this.security_policy.status="1":this.security_policy.status="0",console.log(this.security_policy),this.$axios.put("/yiiapi/securitypolicy/set-security-policy",{min_passwd_len:this.security_policy.min_passwd_len,max_passwd_len:this.security_policy.max_passwd_len,passwd_regular_edit_time:this.security_policy.passwd_regular_edit_time,admin_faild_logon_time:this.security_policy.admin_faild_logon_time,admin_logon_delay_time:this.security_policy.admin_logon_delay_time,session_timeout:this.security_policy.session_timeout,admin_online_count:this.security_policy.admin_online_count,status:this.security_policy.status}).then(function(e){console.log(e),0==e.data.status?(t.get_data(),t.$message({message:"修改成功！",type:"success"})):t.$message.error({message:e.data.msg,type:"error"})}).catch(function(t){console.log(t)})},reset_data:function(){this.get_data()},handleChange_pswd_min:function(){},handleChange_pswd_max:function(){}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.security_policy_status.loading,expression:"security_policy_status.loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"security_policy"}},[s("div",{staticClass:"top"},[s("span",[t._v("是否启用:")]),t._v(" "),s("el-switch",{model:{value:t.security_policy_status.switch,callback:function(e){t.$set(t.security_policy_status,"switch",e)},expression:"security_policy_status.switch"}})],1),t._v(" "),s("div",{staticClass:"mid"},[s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("密码长度最小值：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:8,max:11,label:"请输入密码长度最小值"},on:{change:t.handleChange_pswd_min},model:{value:t.security_policy.min_passwd_len,callback:function(e){t.$set(t.security_policy,"min_passwd_len",e)},expression:"security_policy.min_passwd_len"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("密码最小长度8-11之间包含大小写字母和数字")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("密码长度最大值：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:11,max:30,label:"请输入密码长度最大值"},on:{change:t.handleChange_pswd_max},model:{value:t.security_policy.max_passwd_len,callback:function(e){t.$set(t.security_policy,"max_passwd_len",e)},expression:"security_policy.max_passwd_len"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("密码最大长度11-30之间包含大小写字母和数字")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("密码定期修改时间：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:90,label:"请输入密码定期修改时间"},model:{value:t.security_policy.passwd_regular_edit_time,callback:function(e){t.$set(t.security_policy,"passwd_regular_edit_time",e)},expression:"security_policy.passwd_regular_edit_time"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("(1-90)天")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("最大登录重试次数：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:5,label:"请输入最大登录重试次数"},model:{value:t.security_policy.admin_faild_logon_time,callback:function(e){t.$set(t.security_policy,"admin_faild_logon_time",e)},expression:"security_policy.admin_faild_logon_time"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("(1-5)次")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("登录失败阻断时间：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:3600,label:"请输入登录失败阻断时间"},model:{value:t.security_policy.admin_logon_delay_time,callback:function(e){t.$set(t.security_policy,"admin_logon_delay_time",e)},expression:"security_policy.admin_logon_delay_time"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("(1-3600)秒")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("页面超时时间：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:480,label:"请输入页面超时时间"},model:{value:t.security_policy.session_timeout,callback:function(e){t.$set(t.security_policy,"session_timeout",e)},expression:"security_policy.session_timeout"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("(1-480)分钟")])],1),t._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[t._v("同时在线数：")]),t._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:5,label:"请输入同时在线数"},model:{value:t.security_policy.admin_online_count,callback:function(e){t.$set(t.security_policy,"admin_online_count",e)},expression:"security_policy.admin_online_count"}}),t._v(" "),s("span",{staticClass:"red"},[t._v("*")]),t._v(" "),s("span",{staticClass:"item_color"},[t._v("(1-5)个")])],1)]),t._v(" "),s("div",{staticClass:"bottom"},[s("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:t.set_data}},[t._v("保存")]),t._v(" "),s("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:t.reset_data}},[t._v("取消")])],1)])},staticRenderFns:[]};var h={components:{userManagement:d,roleManagement:u,securityPolicy:s("VU/8")(p,m,!1,function(t){s("q4iZ"),s("At1p")},"data-v-910deda0",null).exports},name:"system_control_account",data:function(){return{activeName:"first",tab_show:{first:!0,second:!1,third:!1}}},methods:{handleClick:function(t,e){switch(console.log(t),t.name){case"first":this.tab_show.first=!0,this.tab_show.second=!1,this.tab_show.third=!1;break;case"second":this.tab_show.first=!1,this.tab_show.second=!0,this.tab_show.third=!1;break;case"third":this.tab_show.first=!1,this.tab_show.second=!1,this.tab_show.third=!0}}}},v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"system_control_account"}},[s("div",{staticClass:"content_box"},[s("el-tabs",{staticClass:"reset_tab",on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"用户管理",name:"first"}},[t.tab_show.first?s("user-management"):t._e()],1),t._v(" "),s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"角色管理",name:"second"}},[t.tab_show.second?s("role-management"):t._e()],1),t._v(" "),s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"用户安全策略",name:"third"}},[t.tab_show.third?s("security-policy"):t._e()],1)],1)],1)])},staticRenderFns:[]};var b=s("VU/8")(h,v,!1,function(t){s("Bf9R"),s("d+4O")},"data-v-dba8a74a",null);e.default=b.exports},At1p:function(t,e){},Bf9R:function(t,e){},Ct0g:function(t,e){},J8Ht:function(t,e){},JKxE:function(t,e){},MI9h:function(t,e){},"d+4O":function(t,e){},q4iZ:function(t,e){}});